# 滑动窗口功能测试报告

**测试日期**: 2026-01-17  
**测试环境**: TranslateGemma 27B-Q8, NVIDIA GPU

> 📌 **完整研究报告**: 请参阅 [docs/CHUNKING_RESEARCH_REPORT.md](docs/CHUNKING_RESEARCH_REPORT.md)

---

## 快速结论

### 推荐配置

```env
MAX_CHUNK_LENGTH=100   # 安全边界，保证完整性
DEFAULT_OVERLAP=0      # 默认关闭，避免重复
```

### 核心发现

| 发现 | 说明 |
|------|------|
| ✅ chunk_size=100 是安全边界 | 超过此值会触发模型截断 |
| ✅ 模型自动保持术语一致性 | 无需滑动窗口也能保持代词、术语一致 |
| ⚠️ 滑动窗口会导致重复 | overlap 部分被翻译两次 |
| ⚠️ 滑动窗口对大 chunk 帮助有限 | 只能从 44% 提升到 56% |

---

## 测试结果摘要

### 分块完整度测试

| chunk_size | overlap | 完整度 | 状态 |
|------------|---------|--------|------|
| 80 | 0 | 100% | ✅ |
| **100** | **0** | **100%** | ✅ **推荐** |
| 120 | 0 | 44% | ❌ |
| 120 | 30 | 56% | ⚠️ |
| 150 | 0 | 44% | ❌ |
| 150 | 40 | 56% | ⚠️ |

### 上下文一致性测试

| 测试项 | 无 overlap | 有 overlap |
|--------|-----------|------------|
| 代词一致性 | ✅ 一致 | ✅ 一致 |
| 术语一致性 | ✅ 一致 | ✅ 一致 |
| 专有名词 | ✅ 一致 | ✅ 一致 |
| 重复内容 | ❌ 无 | ⚠️ 有 |

---

## API 使用

```python
# 标准翻译（推荐）
{
    "text": "...",
    "target_lang": "en",
    "chunk_size": 100,
    "overlap": 0
}

# 需要强上下文时（接受重复）
{
    "text": "...",
    "target_lang": "en",
    "chunk_size": 100,
    "overlap": 20
}
```

---

*详细测试数据和分析请参阅完整研究报告*
